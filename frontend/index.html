<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Cờ Caro - Sảnh Chờ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="logo">TRÒ CHƠI CARO</div>
        <div class="header-right">
            <div class="user-menu-container">
                <i class="fas fa-user-circle" id="userIcon" onclick="toggleDropdown()"></i>
                <div class="dropdown-content" id="userDropdown">
                    <div id="guestMenu">
                        <a href="javascript:void(0)" onclick="openModal('login')">Đăng nhập</a>
                        <a href="javascript:void(0)" onclick="openModal('register')">Đăng ký</a>
                    </div>
                    <div id="userMenu" class="hidden">
                        <div class="user-info-header">Chào, <span id="displayUsername">Player</span></div>
                        <a href="javascript:void(0)"><i class="fas fa-info-circle"></i> Thông tin</a>
                        <a href="javascript:void(0)"><i class="fas fa-history"></i> Lịch sử đấu</a>
                        <hr style="border: 0; border-top: 1px solid #333; margin: 0;">
                        <a href="javascript:void(0)" onclick="handleLogout()" style="color: #2ecc71;"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="lobby-container">
        <section class="lobby-main">
            <div class="welcome-box">
                <h1>Chào mừng đến với trò chơi Caro</h1>
                <p>Hệ thống thách đấu trực tiếp qua Socket Network</p>
            </div>
        </section>

        <aside class="sidebar-online">
            <div class="online-header">
                <h3><i class="fas fa-signal"></i> ĐANG ONLINE</h3>
                <span class="count-badge">1</span>
            </div>
            <div class="user-list" id="onlineUsers">
                <div class="user-item-wrapper">
                    <div class="user-item">
                        <div class="user-info">
                            <span class="status-dot"></span> 
                            <span class="username">Admin_Master</span>
                        </div>
                        <button class="btn-challenge" onclick="toggleChallengePop('Admin_Master')">Thách đấu</button>
                    </div>
                    <div id="pop-Admin_Master" class="challenge-pop hidden">
                        <p>Thách đấu <strong>Admin_Master</strong>?</p>
                        <div class="pop-actions">
                            <button class="btn-confirm" onclick="acceptChallenge('Admin_Master')">Chấp nhận</button>
                            <button class="btn-cancel" onclick="toggleChallengePop('Admin_Master')">Từ chối</button>
                        </div>
                        <div class="pop-arrow"></div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <div id="authModal" class="modal-overlay hidden">
        <div class="modal-box">
            <h2 id="modalTitle">Đăng Nhập</h2>
            <form id="authForm" onsubmit="handleAuth(event)">
                <div class="form-group">
                    <input type="text" id="usernameInput" required placeholder=" ">
                    <label>Tên tài khoản</label>
                </div>
                <div class="form-group">
                    <input type="password" id="passwordInput" required placeholder=" ">
                    <label>Mật khẩu</label>
                </div>
                <div id="registerFields" class="hidden">
                    <div class="form-group">
                        <input type="password" id="confirmPasswordInput" placeholder=" ">
                        <label>Xác nhận mật khẩu</label>
                    </div>
                </div>
                
                <button type="submit" class="btn-submit" id="submitBtn">Xác nhận</button>
                
                <p class="switch-mode">
                    <span id="switchText">Chưa có tài khoản?</span> 
                    <a href="javascript:void(0)" id="switchBtn" onclick="toggleAuthMode()">Đăng ký ngay</a>
                </p>
            </form>
            <button class="close-btn" onclick="closeModal()">×</button>
        </div>
    </div>

    <script>
        let isLoginMode = true;

        function toggleDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function openModal(mode) {
            isLoginMode = (mode === 'login');
            updateModalUI();
            document.getElementById('authModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('authModal').classList.add('hidden');
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            updateModalUI();
        }

        function updateModalUI() {
            const title = document.getElementById('modalTitle');
            const regFields = document.getElementById('registerFields');
            const switchText = document.getElementById('switchText');
            const switchBtn = document.getElementById('switchBtn');
            const submitBtn = document.getElementById('submitBtn');

            if (isLoginMode) {
                title.innerText = 'Đăng Nhập';
                regFields.classList.add('hidden');
                switchText.innerText = 'Chưa có tài khoản?';
                switchBtn.innerText = 'Đăng ký ngay';
                submitBtn.innerText = 'Đăng Nhập';
                submitBtn.style.backgroundColor = "#2ecc71";
            } else {
                title.innerText = 'Đăng Ký';
                regFields.classList.remove('hidden');
                switchText.innerText = 'Đã có tài khoản?';
                switchBtn.innerText = 'Đăng nhập ngay';
                submitBtn.innerText = 'Tạo Tài Khoản';
                submitBtn.style.backgroundColor = "#2ecc71";
            }
        }

        function acceptChallenge(username) {
            const roomId = 'ROOM-' + Math.floor(1000 + Math.random() * 9000);
            window.location.href = `game.html?id=${roomId}&opponent=${username}`;
        }

        function handleAuth(e) {
            e.preventDefault();
            const username = document.getElementById('usernameInput').value;
            document.getElementById('guestMenu').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            document.getElementById('displayUsername').innerText = username;
            closeModal();
        }

        function handleLogout() {
            location.reload();
        }

        function toggleChallengePop(username) {
            document.getElementById('pop-' + username).classList.toggle('hidden');
        }

        window.onclick = function(event) {
            if (!event.target.matches('#userIcon')) {
                const dropdowns = document.getElementsByClassName("dropdown-content");
                for (let i = 0; i < dropdowns.length; i++) {
                    dropdowns[i].classList.remove('show');
                }
            }
        }
    </script>
</body>
</html>
