<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trận Đấu Caro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body style="display:flex; justify-content:center; align-items:center; height:100vh;">
    <div id="game-ui" class="game-container">
        <div>
            <div style="margin-bottom:15px; font-weight:700; display:flex; justify-content:space-between;">
                <span># Mã Phòng: <span style="color:red;">#12345</span></span>
                <span style="color:var(--primary); cursor:pointer;"><i class="far fa-copy"></i> Sao chép</span>
            </div>
            <div class="caro-grid" id="grid"></div>
        </div>
        <div style="width:320px; display:flex; flex-direction:column; gap:15px;">
            <div class="card" style="text-align:center; background:#f8fafc; border:1px solid #e2e8f0; padding:15px;">
                <small style="font-weight:800; color:#64748b;">LƯỢT ĐI HIỆN TẠI</small>
                <div style="font-size:45px; font-weight:900; color:red;" id="turn">X</div>
            </div>
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:15px;">
                <div style="text-align:center;"><div class="avt-circle" style="width:40px; height:40px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#cbd5e1; margin:0 auto 5px;"><i class="fas fa-user"></i></div><small>Bạn (O)</small></div>
                <b>VS</b>
                <div style="text-align:center;"><div class="avt-circle" style="width:40px; height:40px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; color:red; margin:0 auto 5px;"><i class="fas fa-user"></i></div><small id="opp-name">Đối thủ (X)</small></div>
            </div>
            <div class="card" style="flex:1; display:flex; flex-direction:column;">
                <small style="font-weight:800; color:#64748b; margin-bottom:10px;">HỘP THOẠI CHAT</small>
                <div id="chat-box" style="flex:1; background:#f8fafc; border-radius:8px; padding:10px; font-size:12px; border:1px solid #eee; min-height:80px; overflow-y:auto;">
                    <i style="color:green;">[Hệ thống]: Trận đấu bắt đầu!</i>
                </div>
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <input type="text" id="chat-input" placeholder="Nhập tin nhắn..." style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd; outline:none; font-size:12px;">
                    <button class="btn btn-primary" style="padding:8px; width:40px; background:#2ecc71;" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
                <button class="btn btn-red-solid" onclick="confirmAction('surrender')"><i class="fas fa-flag"></i> Đầu hàng</button>
                <button class="btn btn-outline" onclick="handleReplay()"><i class="fas fa-redo"></i> Chơi lại</button>
                <button class="btn btn-outline btn-red" style="grid-column: span 2;" onclick="confirmAction('exit')"><i class="fas fa-sign-out-alt"></i> Rời khỏi phòng</button>
            </div>
        </div>
    </div>

    <div id="modal-result" class="modal-overlay hidden">
        <div class="result-card">
            <h1 class="res-title">KẾT QUẢ TRẬN ĐẤU</h1>
            <h2 style="margin-bottom:30px; font-size: 20px;">NGƯỜI CHIẾN THẮNG: <span id="winner-name" style="color:var(--primary); font-weight: 900;"></span></h2>
            <div class="res-flex">
                <div class="res-box res-lose">
                    <span class="res-name">BẠN</span>
                    <p class="res-info">Kết quả:</p>
                    <span style="font-weight:800; color:#ef4444;">THUA CUỘC</span>
                </div>
                <div class="res-box res-win">
                    <span class="res-name" id="winner-tag">ĐỐI THỦ</span>
                    <p class="res-info">Kết quả:</p>
                    <span style="font-weight:800; color:#2ecc71;">THẮNG CUỘC</span>
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content: center;">
                <button class="btn btn-blue" onclick="handleReplay(); document.getElementById('modal-result').classList.add('hidden')">CHƠI LẠI</button>
                <button class="btn btn-primary" style="width:auto; padding:12px 40px;" onclick="window.location.href='index.html'">VỀ SẢNH CHÍNH</button>
            </div>
        </div>
    </div>

    <div id="modal-confirm" class="modal-overlay hidden">
        <div class="confirm-modal">
            <i id="confirm-icon" class="fas" style="font-size:40px; margin-bottom:15px; display:block;"></i>
            <h3 id="confirm-title" style="margin-bottom:10px;"></h3>
            <p id="confirm-desc" style="font-size:14px; color:#64748b; margin-bottom:25px;"></p>
            <div style="display:flex; gap:10px;"><button class="btn btn-red-solid" style="flex:1" onclick="executeConfirm()">CHẤP NHẬN</button><button class="btn btn-outline" style="flex:1" onclick="closeConfirm()">HỦY</button></div>
        </div>
    </div>

    <script>
        const p = new URLSearchParams(window.location.search);
        if(p.get('opp')) document.getElementById('opp-name').innerText = p.get('opp') + " (X)";
        const grid = document.getElementById('grid'); let cur = 'X'; let pendingAction = "";

        function createBoard() { grid.innerHTML = ""; for (let i = 0; i < 225; i++) { const c = document.createElement('div'); c.className = 'cell'; c.onclick = function() { if(!this.innerText) { this.innerText = cur; this.style.color = (cur === 'X') ? 'red' : 'blue'; cur = (cur === 'X') ? 'O' : 'X'; document.getElementById('turn').innerText = cur; document.getElementById('turn').style.color = (cur === 'X') ? 'red' : 'blue'; } }; grid.appendChild(c); } }
        
        function sendMessage() {
            const input = document.getElementById('chat-input'), box = document.getElementById('chat-box');
            if(input.value.trim() !== "") {
                box.innerHTML += `<div style="margin-bottom:5px;"><b>Bạn:</b> ${input.value}</div>`;
                input.value = ""; box.scrollTop = box.scrollHeight;
            }
        }

        function confirmAction(type) {
            pendingAction = type;
            const modal = document.getElementById('modal-confirm'), icon = document.getElementById('confirm-icon'), title = document.getElementById('confirm-title'), desc = document.getElementById('confirm-desc');
            if(type === 'surrender') { icon.className = "fas fa-flag"; icon.style.color = "#ef4444"; title.innerText = "Đầu Hàng"; desc.innerText = "Bạn có chắc muốn Đầu Hàng? Đối thủ sẽ thắng cuộc."; }
            else { icon.className = "fas fa-sign-out-alt"; icon.style.color = "#64748b"; title.innerText = "Rời Phòng"; desc.innerText = "Bạn có chắc muốn rời trận đấu và quay về sảnh chính?"; }
            modal.classList.remove('hidden');
        }
        function closeConfirm() { document.getElementById('modal-confirm').classList.add('hidden'); }
        function executeConfirm() {
            if(pendingAction === 'surrender') { closeConfirm(); document.getElementById('modal-result').classList.remove('hidden'); document.getElementById('winner-name').innerText = document.getElementById('opp-name').innerText; document.getElementById('winner-tag').innerText = document.getElementById('opp-name').innerText; }
            else { window.location.href = "index.html"; }
        }
        function handleReplay() { if(confirm("Làm mới bàn cờ?")) { createBoard(); cur = 'X'; document.getElementById('turn').innerText = 'X'; document.getElementById('turn').style.color = 'red'; } }
        createBoard();
    </script>
</body>
</html>
